<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Online Safety Course (EN/AR) â€” 3 Sections</title>
  <style>
    :root{
      --bg:#f6f8ff;
      --bg2:#eef3ff;
      --card:#ffffff;
      --line:#dfe6ff;
      --text:#152046;
      --muted:#53608f;
      --accent:#5a67ff;
      --accent2:#12b3a8;
      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 10px 30px rgba(21,32,70,.08);
      --r:16px;
      --sans: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(900px 500px at 15% 5%, rgba(90,103,255,.20), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(18,179,168,.14), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }
    header{
      position:sticky; top:0; z-index:10;
      background: rgba(246,248,255,.75);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1000px; margin:0 auto; padding:16px;}
    .top{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
    }
    .brand{display:flex; align-items:center; gap:12px;}
    .logo{
      width:44px; height:44px; border-radius:14px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(90,103,255,.95), rgba(18,179,168,.95));
      color:white;
      box-shadow: 0 10px 25px rgba(90,103,255,.18);
      font-weight:900;
    }
    h1{margin:0; font-size:16px; line-height:1.2}
    .sub{margin:0; font-size:12px; color:var(--muted)}
    .right{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
      color:var(--muted);
      white-space:nowrap;
    }
    .langBtn{
      border:1px solid rgba(90,103,255,.35);
      background: rgba(90,103,255,.10);
      padding:9px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
      color:var(--text);
    }

    main{padding:18px 0 34px}
    .grid{display:grid; grid-template-columns: 330px 1fr; gap:14px;}
    @media (max-width: 920px){ .grid{grid-template-columns:1fr;} }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .bd{padding:14px}
    .title{font-size:14px; margin:0}
    .muted{color:var(--muted); font-size:12px}
    .progress{
      height:10px; border-radius:999px;
      background: rgba(90,103,255,.08);
      border:1px solid var(--line);
      overflow:hidden;
      margin-top:10px;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(90,103,255,.95), rgba(18,179,168,.95));
      transition: width .25s ease;
    }

    .sectionCard{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      background: linear-gradient(180deg, rgba(90,103,255,.06), rgba(18,179,168,.04));
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-top:10px;
    }
    .sectionCard.locked{opacity:.55; filter:saturate(.7);}
    .badge{
      width:34px; height:34px; border-radius:12px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.9);
      border:1px solid var(--line);
      color: var(--text);
      font-size:18px;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.95);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:800;
      transition:.15s transform,.15s border,.15s background;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(18,179,168,.35);}
    .btn.primary{
      border-color: rgba(90,103,255,.35);
      background: rgba(90,103,255,.10);
    }
    .btn:disabled{cursor:not-allowed; opacity:.55; transform:none;}

    /* Right panel content */
    .big{
      font-size:18px;
      font-weight:950;
      margin:0 0 4px;
      letter-spacing:.2px;
    }
    .note{
      padding:12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
    }
    ul{margin:8px 0 0 18px}
    li{margin:6px 0}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .divider{height:1px; background: var(--line); margin:12px 0}

    .q{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      background: rgba(255,255,255,.92);
    }
    .q h3{margin:0 0 8px; font-size:14px}
    .choices{display:grid; gap:8px;}
    .choice{
      text-align:left;
      padding:10px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(90,103,255,.05);
      cursor:pointer;
      transition:.15s transform,.15s border,.15s background;
      font-weight:700;
      color:var(--text);
    }
    .choice:hover{transform: translateY(-1px); border-color: rgba(90,103,255,.35);}
    .choice[aria-pressed="true"]{
      border-color: rgba(18,179,168,.55);
      background: rgba(18,179,168,.10);
      box-shadow: 0 0 0 3px rgba(18,179,168,.12);
    }
    .choice:disabled{opacity:.8; cursor:not-allowed; transform:none;}
    .choice.correct{border-color: rgba(22,163,74,.45); background: rgba(22,163,74,.10);}
    .choice.wrong{border-color: rgba(239,68,68,.45); background: rgba(239,68,68,.10);}
    .callout{
      border-radius: 14px;
      padding:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.92);
    }
    .callout.ok{border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.08);}
    .callout.warn{border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.08);}
    .callout.bad{border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.08);}

    footer{color:var(--muted); font-size:12px; padding:14px 0 0}

    /* RTL support */
    html[dir="rtl"] ul{margin:8px 18px 0 0}
    html[dir="rtl"] .choice{text-align:right}
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">ğŸ›¡ï¸</div>
        <div>
          <h1 id="brandTitle">Online Safety Course</h1>
          <p class="sub" id="brandSub">3 sections â€” unlock as you pass</p>
        </div>
      </div>

      <div class="right">
        <span class="pill"><span id="scoreLabel">Points</span>: <strong id="points">0</strong></span>
        <span class="pill"><span id="statusLabel">Unlocked</span>: <strong id="unlockCount">1</strong>/3</span>
        <button class="langBtn" id="langToggle">AR</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <!-- LEFT: Sections -->
    <aside class="card">
      <div class="hd">
        <h2 class="title" id="sectionsTitle">Sections</h2>
        <button class="btn" id="resetBtn">Reset</button>
      </div>
      <div class="bd">
        <div class="muted" id="leftHelp">
          Complete Section 1 to unlock Section 2, then Section 3.
        </div>

        <div class="progress" aria-label="Course progress">
          <div class="bar" id="progressBar"></div>
        </div>

        <div class="sectionCard" id="secCard1">
          <div class="row" style="gap:12px">
            <div class="badge">1</div>
            <div>
              <strong id="sec1Name">Passwords & Codes</strong>
              <div class="muted" id="sec1Hint">Simple steps + 3 MCQ</div>
            </div>
          </div>
          <button class="btn primary" id="open1">Open</button>
        </div>

        <div class="sectionCard locked" id="secCard2">
          <div class="row" style="gap:12px">
            <div class="badge">2</div>
            <div>
              <strong id="sec2Name">Links & Downloads</strong>
              <div class="muted" id="sec2Hint">Unlock after Section 1</div>
            </div>
          </div>
          <button class="btn primary" id="open2" disabled>Locked</button>
        </div>

        <div class="sectionCard locked" id="secCard3">
          <div class="row" style="gap:12px">
            <div class="badge">3</div>
            <div>
              <strong id="sec3Name">Privacy & Posting</strong>
              <div class="muted" id="sec3Hint">Unlock after Section 2</div>
            </div>
          </div>
          <button class="btn primary" id="open3" disabled>Locked</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button class="btn" id="saveBtn">Save</button>
          <button class="btn" id="loadBtn">Load</button>
        </div>
        <div class="muted" id="saveNote" style="margin-top:10px;">
          Saves in this browser only.
        </div>
      </div>
    </aside>

    <!-- RIGHT: Active section -->
    <section class="card">
      <div class="hd">
        <div>
          <div class="big" id="panelTitle">Section 1</div>
          <div class="muted" id="panelSub">Read the steps, then answer 3 questions.</div>
        </div>
        <span class="pill"><span id="sectionPointsLabel">Section points</span>: <strong id="sectionPoints">0</strong>/30</span>
      </div>

      <div class="bd">
        <section id="content"></section>

        <div class="divider"></div>

        <div class="row" style="justify-content:space-between;">
          <div class="muted" id="passRule">Pass rule: 2/3 correct (20 points) unlocks next section.</div>
          <button class="btn primary" id="submitBtn">Submit answers</button>
        </div>

        <div style="height:12px"></div>
        <div class="callout" id="resultBox" hidden></div>

        <footer id="footerText">Tip: If something feels urgent or secret, pause and ask.</footer>
      </div>
    </section>
  </div>
</main>

<script>
  const $ = (q, el=document)=>el.querySelector(q);
  const $$ = (q, el=document)=>Array.from(el.querySelectorAll(q));
  const KEY = "online_safety_3sections_light_bilingual_v1";

  // =========================
  // I18N
  // =========================
  const I18N = {
    en: {
      dir:"ltr",
      brandTitle:"Online Safety Course",
      brandSub:"3 sections â€” unlock as you pass",
      scoreLabel:"Points",
      statusLabel:"Unlocked",
      sectionsTitle:"Sections",
      leftHelp:"Complete Section 1 to unlock Section 2, then Section 3.",
      reset:"Reset",
      save:"Save",
      load:"Load",
      saveNote:"Saves in this browser only.",
      open:"Open",
      locked:"Locked",
      secHints:{
        s1:"Simple steps + 3 MCQ",
        s2:"Unlock after Section 1",
        s3:"Unlock after Section 2"
      },
      panelSub:"Read the steps, then answer 3 questions.",
      sectionPointsLabel:"Section points",
      passRule:"Pass rule: 2/3 correct (20 points) unlocks next section.",
      submit:"Submit answers",
      footer:"Tip: If something feels urgent or secret, pause and ask.",
      resultPass:"Passed âœ… Next section unlocked.",
      resultFail:"Not passed âŒ Review the steps and try again.",
      flashes:{saved:"Saved!", loaded:"Loaded!", nosave:"No save found."}
    },
    ar: {
      dir:"rtl",
      brandTitle:"Ø¯ÙˆØ±Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª",
      brandSub:"Ù£ Ø£Ù‚Ø³Ø§Ù… â€” ØªÙØªØ­ Ø¨Ø§Ù„ØªØ¯Ø±ÙŠØ¬ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­",
      scoreLabel:"Ø§Ù„Ù†Ù‚Ø§Ø·",
      statusLabel:"Ø§Ù„Ù…ÙØªÙˆØ­",
      sectionsTitle:"Ø§Ù„Ø£Ù‚Ø³Ø§Ù…",
      leftHelp:"Ø£ÙƒÙ…Ù„ Ø§Ù„Ù‚Ø³Ù… Ù¡ Ù„ÙØªØ­ Ø§Ù„Ù‚Ø³Ù… Ù¢ØŒ Ø«Ù… Ø§Ù„Ù‚Ø³Ù… Ù£.",
      reset:"Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·",
      save:"Ø­ÙØ¸",
      load:"ØªØ­Ù…ÙŠÙ„",
      saveNote:"ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¯Ø§Ø®Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·.",
      open:"ÙØªØ­",
      locked:"Ù…ØºÙ„Ù‚",
      secHints:{
        s1:"Ø®Ø·ÙˆØ§Øª Ø¨Ø³ÙŠØ·Ø© + Ù£ Ø£Ø³Ø¦Ù„Ø©",
        s2:"ÙŠÙØªØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø³Ù… Ù¡",
        s3:"ÙŠÙØªØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø³Ù… Ù¢"
      },
      panelSub:"Ø§Ù‚Ø±Ø£ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø«Ù… Ø£Ø¬Ø¨ Ø¹Ù† Ù£ Ø£Ø³Ø¦Ù„Ø©.",
      sectionPointsLabel:"Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚Ø³Ù…",
      passRule:"Ø´Ø±Ø· Ø§Ù„Ù†Ø¬Ø§Ø­: Ù¢/Ù£ ØµØ­ÙŠØ­ (Ù¢Ù  Ù†Ù‚Ø·Ø©) Ù„ÙØªØ­ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ØªØ§Ù„ÙŠ.",
      submit:"Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª",
      footer:"Ù†ØµÙŠØ­Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ù…Ø± Ù…Ø³ØªØ¹Ø¬Ù„Ø§Ù‹ Ø£Ùˆ Ø³Ø±ÙŠØ§Ù‹â€¦ ØªÙˆÙ‚Ù ÙˆØ§Ø³Ø£Ù„.",
      resultPass:"Ù†Ø¬Ø­Øª âœ… ØªÙ… ÙØªØ­ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ØªØ§Ù„ÙŠ.",
      resultFail:"Ù„Ù… ØªÙ†Ø¬Ø­ âŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
      flashes:{saved:"ØªÙ… Ø§Ù„Ø­ÙØ¸!", loaded:"ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„!", nosave:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­ÙØ¸."}
    }
  };

  // =========================
  // Course Content (Steps + 3 MCQ each) â€” NEW content
  // Points: 10 per correct answer
  // Pass: 2/3 correct
  // =========================
  const COURSE = {
    en: [
      {
        id:1,
        name:"Passwords & Codes",
        steps:[
          "Use a long passphrase (12+ characters).",
          "Never share one-time codes (OTP) or verification codes.",
          "Turn on 2-step verification when available."
        ],
        questions:[
          {
            q:"Which password is strongest?",
            a:["cat123","Blue!River-Cloud99","password"],
            ok:1,
            why:"Long + mixed characters is harder to guess."
          },
          {
            q:"A friend asks for your OTP code. What should you do?",
            a:["Send it quickly","Never share it","Post it in the group chat"],
            ok:1,
            why:"OTP codes can be used to steal accounts."
          },
          {
            q:"Best place to store passwords is:",
            a:["A password manager or written safely at home","In public notes app","Same password everywhere"],
            ok:0,
            why:"Use safe storage and never reuse passwords."
          }
        ]
      },
      {
        id:2,
        name:"Links & Downloads",
        steps:[
          "Donâ€™t click strange links in messagesâ€”go to the official app/site yourself.",
          "Download apps only from trusted stores.",
          "If something says â€œurgentâ€ or â€œsecretâ€, slow down."
        ],
        questions:[
          {
            q:"Which link looks most suspicious?",
            a:["school.edu/portal","my-game-free-rewards.xyz","library.gov/books"],
            ok:1,
            why:"Random domains + rewards are common scam signs."
          },
          {
            q:"You get a pop-up saying â€œUpdate now!â€ Whatâ€™s safest?",
            a:["Close it and update from the official store/settings","Click the pop-up","Ask the pop-up for help"],
            ok:0,
            why:"Updates should come from official sources."
          },
          {
            q:"A message says: â€œDonâ€™t tell anyone. Click now.â€ This is a:",
            a:["Red flag","Normal reminder","Teacher instruction"],
            ok:0,
            why:"Secrecy + urgency is a scam tactic."
          }
        ]
      },
      {
        id:3,
        name:"Privacy & Posting",
        steps:[
          "Keep your profile private and accept only people you know in real life.",
          "Before posting photos, check for school name, address, or schedule.",
          "If someone bothers you: block, report, screenshot, tell an adult."
        ],
        questions:[
          {
            q:"What is OK to post publicly?",
            a:["Your address","A photo showing your timetable","A drawing with no personal details"],
            ok:2,
            why:"Share content that doesnâ€™t reveal identity or location."
          },
          {
            q:"Best setting for friend requests is:",
            a:["Everyone","Only people I know","Strangers only"],
            ok:1,
            why:"Limit contact to real-life connections."
          },
          {
            q:"Someone is bullying you online. Best action?",
            a:["Argue back","Block/report and tell a trusted adult","Share their private info"],
            ok:1,
            why:"Donâ€™t escalateâ€”get help and use safety tools."
          }
        ]
      }
    ],
    ar: [
      {
        id:1,
        name:"ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯",
        steps:[
          "Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø§Ø±Ø© Ù…Ø±ÙˆØ± Ø·ÙˆÙŠÙ„Ø© (Ù¡Ù¢ Ø­Ø±ÙØ§Ù‹ Ø£Ùˆ Ø£ÙƒØ«Ø±).",
          "Ù„Ø§ ØªØ´Ø§Ø±Ùƒ Ø£Ø¨Ø¯Ø§Ù‹ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ (OTP) Ø£Ùˆ Ø£ÙŠ ÙƒÙˆØ¯ Ø¯Ø®ÙˆÙ„.",
          "ÙØ¹Ù‘Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø®Ø·ÙˆØªÙŠÙ† Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ù…ØªØ§Ø­Ø§Ù‹."
        ],
        questions:[
          {
            q:"Ø£ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‡ÙŠ Ø§Ù„Ø£Ù‚ÙˆÙ‰ØŸ",
            a:["cat123","Blue!River-Cloud99","password"],
            ok:1,
            why:"Ø·ÙˆÙ„ Ø£ÙƒØ¨Ø± + ØªÙ†ÙˆØ¹ ÙŠØ¬Ø¹Ù„ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø£ØµØ¹Ø¨."
          },
          {
            q:"ØµØ¯ÙŠÙ‚ ÙŠØ·Ù„Ø¨ Ù…Ù†Ùƒ ÙƒÙˆØ¯ OTP. Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ØŸ",
            a:["Ø£Ø±Ø³Ù„Ù‡ Ø¨Ø³Ø±Ø¹Ø©","Ù„Ø§ ØªØ´Ø§Ø±ÙƒÙ‡ Ø£Ø¨Ø¯Ø§Ù‹","Ø§ÙƒØªØ¨Ù‡ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØµÙ"],
            ok:1,
            why:"Ø£ÙƒÙˆØ§Ø¯ OTP Ù‚Ø¯ ØªÙØ³ØªØ®Ø¯Ù… Ù„Ø³Ø±Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨."
          },
          {
            q:"Ø£ÙØ¶Ù„ Ù…ÙƒØ§Ù† Ù„Ø­ÙØ¸ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù‡Ùˆ:",
            a:["Ù…Ø¯ÙŠØ± ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ø£Ùˆ ÙƒØªØ§Ø¨Ø© Ø¢Ù…Ù†Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©","Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø© Ù„ÙƒÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª"],
            ok:0,
            why:"Ø§Ø­ÙØ¸Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† ÙˆÙ„Ø§ ØªØ¹ÙØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§."
          }
        ]
      },
      {
        id:2,
        name:"Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª",
        steps:[
          "Ù„Ø§ ØªØ¶ØºØ· Ø±ÙˆØ§Ø¨Ø· ØºØ±ÙŠØ¨Ø© ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„â€”Ø§Ø°Ù‡Ø¨ Ù„Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù…ÙŠ Ø¨Ù†ÙØ³Ùƒ.",
          "Ù†Ø²Ù‘Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚Ø© ÙÙ‚Ø·.",
          "Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Â«Ù…Ø³ØªØ¹Ø¬Ù„Ø©Â» Ø£Ùˆ Â«Ø³Ø±ÙŠØ©Â»â€¦ ØªÙ…Ù‡Ù‘Ù„."
        ],
        questions:[
          {
            q:"Ø£ÙŠ Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ùˆ Ø§Ù„Ø£ÙƒØ«Ø± Ø±ÙŠØ¨Ø©ØŸ",
            a:["school.edu/portal","my-game-free-rewards.xyz","library.gov/books"],
            ok:1,
            why:"Ù†Ø·Ø§Ù‚Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© + Ù…ÙƒØ§ÙØ¢Øª ØºØ§Ù„Ø¨Ø§Ù‹ Ø¹Ù„Ø§Ù…Ø© Ø§Ø­ØªÙŠØ§Ù„."
          },
          {
            q:"Ø¸Ù‡Ø±Øª Ù†Ø§ÙØ°Ø© ØªÙ‚ÙˆÙ„ Â«Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¢Ù†!Â». Ù…Ø§ Ø§Ù„Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹ØŸ",
            a:["Ø£ØºÙ„Ù‚Ù‡Ø§ ÙˆØ­Ø¯Ù‘Ø« Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±/Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©","Ø§Ø¶ØºØ· Ø§Ù„Ù†Ø§ÙØ°Ø©","Ø§Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø©"],
            ok:0,
            why:"Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ù† Ù…ØµØ¯Ø± Ø±Ø³Ù…ÙŠ."
          },
          {
            q:"Ø±Ø³Ø§Ù„Ø© ØªÙ‚ÙˆÙ„: Â«Ù„Ø§ ØªØ®Ø¨Ø± Ø£Ø­Ø¯Ø§Ù‹. Ø§Ø¶ØºØ· Ø§Ù„Ø¢Ù†Â». Ù‡Ø°Ø§:",
            a:["Ø¥Ø´Ø§Ø±Ø© Ø®Ø·Ø±","ØªØ°ÙƒÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ","ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ø¹Ù„Ù…"],
            ok:0,
            why:"Ø§Ù„Ø³Ø±ÙŠØ© + Ø§Ù„Ø§Ø³ØªØ¹Ø¬Ø§Ù„ Ø£Ø³Ù„ÙˆØ¨ Ø´Ø§Ø¦Ø¹ Ù„Ù„Ø§Ø­ØªÙŠØ§Ù„."
          }
        ]
      },
      {
        id:3,
        name:"Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ù†Ø´Ø±",
        steps:[
          "Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø®Ø§ØµØ§Ù‹ ÙˆÙ„Ø§ ØªÙ‚Ø¨Ù„ Ø¥Ù„Ø§ Ù…Ù† ØªØ¹Ø±ÙÙ‡Ù… ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹.",
          "Ù‚Ø¨Ù„ Ù†Ø´Ø± Ø§Ù„ØµÙˆØ±ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø¬Ø¯ÙˆÙ„.",
          "Ø¥Ø°Ø§ Ø£Ø²Ø¹Ø¬Ùƒ Ø£Ø­Ø¯: Ø§Ø­Ø¸Ø±ØŒ Ø£Ø¨Ù„ØºØŒ Ø§Ù„ØªÙ‚Ø· Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©ØŒ ÙˆØ£Ø®Ø¨Ø± Ø´Ø®ØµØ§Ù‹ Ø¨Ø§Ù„ØºØ§Ù‹."
        ],
        questions:[
          {
            q:"Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ† Ù†Ø´Ø±Ù‡ Ù„Ù„Ø¹Ø§Ù…Ø© ØºØ§Ù„Ø¨Ø§Ù‹ØŸ",
            a:["Ø¹Ù†ÙˆØ§Ù† Ù…Ù†Ø²Ù„Ùƒ","ØµÙˆØ±Ø© ØªØ¸Ù‡Ø± Ø¬Ø¯ÙˆÙ„Ùƒ","Ø±Ø³Ù… Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©"],
            ok:2,
            why:"Ø§Ù†Ø´Ø± Ù…Ø§ Ù„Ø§ ÙŠÙƒØ´Ù Ø§Ù„Ù‡ÙˆÙŠØ© Ø£Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹."
          },
          {
            q:"Ø£ÙØ¶Ù„ Ø¥Ø¹Ø¯Ø§Ø¯ Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù‡Ùˆ:",
            a:["Ø§Ù„Ø¬Ù…ÙŠØ¹","ÙÙ‚Ø· Ù…Ù† Ø£Ø¹Ø±ÙÙ‡Ù…","ØºØ±Ø¨Ø§Ø¡ ÙÙ‚Ø·"],
            ok:1,
            why:"Ù‚Ù„Ù‘Ù„ ØªÙˆØ§ØµÙ„ Ø§Ù„ØºØ±Ø¨Ø§Ø¡."
          },
          {
            q:"Ø´Ø®Øµ ÙŠØªÙ†Ù…Ø± Ø¹Ù„ÙŠÙƒ. Ø£ÙØ¶Ù„ ØªØµØ±ÙØŸ",
            a:["Ø¬Ø§Ø¯Ù„Ù‡","Ø§Ø­Ø¸Ø±/Ø£Ø¨Ù„Øº ÙˆØ£Ø®Ø¨Ø± Ø´Ø®ØµØ§Ù‹ Ø¨Ø§Ù„ØºØ§Ù‹ ØªØ«Ù‚ Ø¨Ù‡","Ø§Ù†Ø´Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡ Ø§Ù„Ø®Ø§ØµØ©"],
            ok:1,
            why:"Ù„Ø§ ØªØµØ¹Ù‘Ø¯â€”Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©."
          }
        ]
      }
    ]
  };

  // =========================
  // State
  // =========================
  const state = {
    lang: "en",
    unlocked: 1,         // 1..3
    active: 1,           // active section
    points: 0,
    section: {
      1: { answers:{}, submitted:false, score:0, passed:false },
      2: { answers:{}, submitted:false, score:0, passed:false },
      3: { answers:{}, submitted:false, score:0, passed:false }
    }
  };

  // =========================
  // Helpers
  // =========================
  function escape(s){
    return String(s)
      .replaceAll("&","&amp;").replaceAll("<","&lt;")
      .replaceAll(">","&gt;").replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function flash(msg){
    const sub = $("#brandSub");
    const old = sub.textContent;
    sub.textContent = msg;
    sub.style.color = "var(--accent2)";
    setTimeout(()=>{ sub.textContent = old; sub.style.color=""; }, 1200);
  }
  function save(){
    localStorage.setItem(KEY, JSON.stringify(state));
    flash(I18N[state.lang].flashes.saved);
  }
  function load(){
    const raw = localStorage.getItem(KEY);
    if(!raw) return flash(I18N[state.lang].flashes.nosave);
    try{
      const data = JSON.parse(raw);
      Object.assign(state, data);
      if(!I18N[state.lang]) state.lang = "en";
      renderAll();
      flash(I18N[state.lang].flashes.loaded);
    }catch{
      flash("Error");
    }
  }
  function resetAll(){
    localStorage.removeItem(KEY);
    location.reload();
  }
  function setLang(next){
    state.lang = next;
    renderAll();
  }

  // =========================
  // Render: left panel + right panel
  // =========================
  function applyI18n(){
    const t = I18N[state.lang];
    document.documentElement.lang = state.lang;
    document.documentElement.dir = t.dir;

    $("#brandTitle").textContent = t.brandTitle;
    $("#brandSub").textContent = t.brandSub;

    $("#scoreLabel").textContent = t.scoreLabel;
    $("#statusLabel").textContent = t.statusLabel;

    $("#sectionsTitle").textContent = t.sectionsTitle;
    $("#resetBtn").textContent = t.reset;

    $("#leftHelp").textContent = t.leftHelp;

    $("#saveBtn").textContent = t.save;
    $("#loadBtn").textContent = t.load;
    $("#saveNote").textContent = t.saveNote;

    $("#panelSub").textContent = t.panelSub;
    $("#sectionPointsLabel").textContent = t.sectionPointsLabel;
    $("#passRule").textContent = t.passRule;
    $("#submitBtn").textContent = t.submit;
    $("#footerText").textContent = t.footer;

    // section names/hints
    const c = COURSE[state.lang];
    $("#sec1Name").textContent = c[0].name;
    $("#sec2Name").textContent = c[1].name;
    $("#sec3Name").textContent = c[2].name;

    $("#sec1Hint").textContent = t.secHints.s1;
    $("#sec2Hint").textContent = t.secHints.s2;
    $("#sec3Hint").textContent = t.secHints.s3;

    // buttons
    $("#open1").textContent = t.open;
    $("#open2").textContent = (state.unlocked >= 2) ? t.open : t.locked;
    $("#open3").textContent = (state.unlocked >= 3) ? t.open : t.locked;

    // lang toggle label
    $("#langToggle").textContent = (state.lang === "en") ? "AR" : "EN";
  }

  function renderLeft(){
    $("#points").textContent = state.points;
    $("#unlockCount").textContent = state.unlocked;

    // progress: 0..100 based on passed sections
    const passedCount = [1,2,3].filter(i => state.section[i].passed).length;
    $("#progressBar").style.width = Math.round((passedCount/3)*100) + "%";

    // lock/unlock styling
    const s2Locked = state.unlocked < 2;
    const s3Locked = state.unlocked < 3;

    $("#secCard2").classList.toggle("locked", s2Locked);
    $("#secCard3").classList.toggle("locked", s3Locked);

    $("#open2").disabled = s2Locked;
    $("#open3").disabled = s3Locked;

    // highlight active
    ["secCard1","secCard2","secCard3"].forEach((id, idx)=>{
      const el = $("#"+id);
      el.style.outline = (state.active === idx+1) ? "3px solid rgba(18,179,168,.25)" : "none";
    });
  }

  function renderSection(){
    const t = I18N[state.lang];
    const sec = COURSE[state.lang][state.active-1];
    const secState = state.section[state.active];

    $("#panelTitle").textContent = (state.lang==="en" ? `Section ${sec.id}: ${sec.name}` : `Ø§Ù„Ù‚Ø³Ù… ${sec.id}: ${sec.name}`);

    // compute section points
    $("#sectionPoints").textContent = secState.score;

    // build content: steps + 3 questions
    const wrap = $("#content");
    wrap.innerHTML = "";

    const stepsBox = document.createElement("div");
    stepsBox.className = "note";
    stepsBox.innerHTML = `
      <strong>${escape(state.lang==="en" ? "Simple steps" : "Ø®Ø·ÙˆØ§Øª Ø¨Ø³ÙŠØ·Ø©")}</strong>
      <ul>${sec.steps.map(s=>`<li>${escape(s)}</li>`).join("")}</ul>
    `;
    wrap.appendChild(stepsBox);

    const divider = document.createElement("div");
    divider.className = "divider";
    wrap.appendChild(divider);

    sec.questions.forEach((qq, qi)=>{
      const qBox = document.createElement("div");
      qBox.className = "q";
      qBox.innerHTML = `
        <h3>${escape((qi+1) + ") " + qq.q)}</h3>
        <div class="choices">
          ${qq.a.map((opt, ai)=>`
            <button class="choice" data-qi="${qi}" data-ai="${ai}" aria-pressed="${secState.answers[qi]===ai}">
              ${escape(opt)}
            </button>
          `).join("")}
        </div>
        <div class="muted" id="fb_${qi}" style="margin-top:8px"></div>
      `;
      wrap.appendChild(qBox);
    });

    // selection
    $$(".choice", wrap).forEach(btn=>{
      btn.addEventListener("click", ()=>{
        if(secState.submitted) return;
        const qi = Number(btn.dataset.qi);
        const ai = Number(btn.dataset.ai);
        secState.answers[qi] = ai;

        // update pressed state in that question group
        $$(`.choice[data-qi="${qi}"]`, wrap).forEach(b=>{
          b.setAttribute("aria-pressed", String(Number(b.dataset.ai)===ai));
        });
      });
    });

    // if submitted, show results styles
    if(secState.submitted){
      applySectionResults();
    } else {
      $("#resultBox").hidden = true;
    }
  }

  function applySectionResults(){
    const t = I18N[state.lang];
    const sec = COURSE[state.lang][state.active-1];
    const secState = state.section[state.active];

    // score
    let correct = 0;
    sec.questions.forEach((qq, qi)=>{
      const chosen = secState.answers[qi];
      if(chosen === qq.ok) correct++;
    });

    secState.score = correct * 10; // 10 points each
    const passed = correct >= 2;
    secState.passed = passed;

    $("#points").textContent = state.points;
    $("#sectionPoints").textContent = secState.score;

    // mark buttons
    sec.questions.forEach((qq, qi)=>{
      const chosen = secState.answers[qi];
      const btns = $$(`.choice[data-qi="${qi}"]`);
      btns.forEach(b=>{
        b.disabled = true;
        const ai = Number(b.dataset.ai);
        if(ai === qq.ok) b.classList.add("correct");
        if(ai === chosen && ai !== qq.ok) b.classList.add("wrong");
      });
      const fb = $(`#fb_${qi}`);
      if(fb){
        fb.textContent = (chosen === qq.ok) ? "âœ…" : "âŒ " + qq.why;
      }
    });

    // points awarding: only once per section pass
    // We'll award difference between new score and previously awarded score tracked as "awarded" in saved state.
    // Simple approach: store awarded points in secState.awarded (default 0).
    if(secState.awarded === undefined) secState.awarded = 0;
    const delta = secState.score - secState.awarded;
    if(delta > 0){
      state.points += delta;
      secState.awarded = secState.score;
      $("#points").textContent = state.points;
    }

    // unlock next section
    if(passed && state.unlocked < 3 && state.active === state.unlocked){
      state.unlocked = Math.min(3, state.unlocked + 1);
    }

    // result box
    $("#resultBox").hidden = false;
    $("#resultBox").className = "callout " + (passed ? "ok" : "warn");
    $("#resultBox").innerHTML = `
      <strong>${escape(passed ? t.resultPass : t.resultFail)}</strong>
      <div class="muted" style="margin-top:6px">${escape((state.lang==="en" ? "Score" : "Ø§Ù„Ù†ØªÙŠØ¬Ø©") + ": " + correct + "/3 â€¢ " + (secState.score) + " pts")}</div>
    `;

    renderLeft();
    saveSilent();
  }

  function saveSilent(){
    // save without flashing
    localStorage.setItem(KEY, JSON.stringify(state));
  }

  // =========================
  // Actions
  // =========================
  function openSection(n){
    if(n > state.unlocked) return;
    state.active = n;
    renderAll();
  }

  $("#open1").addEventListener("click", ()=>openSection(1));
  $("#open2").addEventListener("click", ()=>openSection(2));
  $("#open3").addEventListener("click", ()=>openSection(3));

  $("#submitBtn").addEventListener("click", ()=>{
    const sec = COURSE[state.lang][state.active-1];
    const secState = state.section[state.active];

    // ensure all answered
    for(let i=0;i<sec.questions.length;i++){
      if(secState.answers[i] === undefined){
        // quick highlight
        flash(state.lang==="en" ? "Answer all 3 questions first." : "Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø£ÙˆÙ„Ø§Ù‹.");
        return;
      }
    }

    secState.submitted = true;
    applySectionResults();
    renderSection(); // re-render to ensure disabled states apply cleanly
  });

  $("#resetBtn").addEventListener("click", resetAll);
  $("#saveBtn").addEventListener("click", save);
  $("#loadBtn").addEventListener("click", load);

  $("#langToggle").addEventListener("click", ()=>{
    setLang(state.lang === "en" ? "ar" : "en");
  });

  // =========================
  // Init
  // =========================
  function renderAll(){
    applyI18n();
    renderLeft();
    renderSection();
  }

  (function init(){
    const raw = localStorage.getItem(KEY);
    if(raw){
      try{
        const data = JSON.parse(raw);
        Object.assign(state, data);
        if(!I18N[state.lang]) state.lang = "en";
        // safety defaults
        state.unlocked = Math.max(1, Math.min(3, state.unlocked || 1));
        state.active = Math.max(1, Math.min(state.unlocked, state.active || 1));
        state.section = state.section || {1:{answers:{},submitted:false,score:0,passed:false},2:{answers:{},submitted:false,score:0,passed:false},3:{answers:{},submitted:false,score:0,passed:false}};
      }catch{}
    }
    renderAll();
  })();
</script>
</body>
</html>
